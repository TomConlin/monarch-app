if(typeof bbop=="undefined"){var bbop={}}if(typeof bbop.monarch=="undefined"){bbop.monarch={}}bbop.monarch.handler=function(){this._is_a="bbop.monarch.handler";var is_def=bbop.core.is_defined;if(!global_xrefs_conf){throw new Error("global_xrefs_conf is missing!")}this.mangle=bbop.core.uuid();this.string_to_function_map={};this.entries=0};bbop.monarch.handler.prototype.dispatch=function(data,name,context,fallback){var is_def=bbop.core.is_defined;var did=name||"";did+="_"+this.mangle;if(context){did+="_"+context}if(!is_def(this.string_to_function_map[did])){this.entries+=1;if(is_def(global_xrefs_conf[name])){var field_hash=global_xrefs_conf[name];var function_string=null;if(is_def(field_hash.context)&&is_def(field_hash.context[context])){function_string=field_hash.context[context]}else{if(is_def(field_hash["default"])){function_string=field_hash["default"]}}if(function_string==null){throw new Error("global_xrefs_conf appears to be damaged!")}var evalled_thing=eval(function_string);if(!is_def(evalled_thing)||evalled_thing==null||bbop.core.what_is(evalled_thing)!="function"){throw new Error('"'+function_string+'" did not resolve!')}else{this.string_to_function_map[did]=evalled_thing}}else{if(is_def(fallback)){this.string_to_function_map[did]=fallback}else{this.string_to_function_map[did]=null}}}var retval=null;if(this.string_to_function_map[did]!=null){var cfunc=this.string_to_function_map[did];retval=cfunc(data,name,context)}return retval};if(typeof bbop=="undefined"){var bbop={}}if(typeof bbop.monarch=="undefined"){bbop.monarch={}}bbop.monarch.linker=function(){this._is_a="bbop.monarch.linker";if(typeof global_app_base==="undefined"){throw new Error("we are missing access to global_app_base!")}this.app_base=global_app_base;this.generic_item={subject:true,object:true}};bbop.monarch.linker.prototype.url=function(id,xid,modifier,category){var retval=null;if(xid&&xid!=""){if(id&&id!=""){if(this.generic_item[xid]){if(typeof category==="undefined"){throw new Error("category is missing!")}else{if(category!="pathway"&&!(/^_/.test(id))){retval=this.app_base+"/"+category+"/"+id}}}}if(!retval&&id&&id!=""){if(!global_xrefs_conf){throw new Error("global_xrefs_conf is missing!")}var full_id_parts=bbop.core.first_split(":",id);if(full_id_parts&&full_id_parts[0]&&full_id_parts[1]){var src=full_id_parts[0];var sid=full_id_parts[1];var lc_src=src.toLowerCase();var xref=global_xrefs_conf[lc_src];if(xref&&xref.url_syntax){retval=xref.url_syntax.replace("[example_id]",sid,"g")}}}}return retval};bbop.monarch.linker.prototype.img=function(id,xid,modifier,category){var retval=null;if(xid&&xid!=""){if(!retval&&id&&id!=""){if(!global_xrefs_conf){throw new Error("global_xrefs_conf is missing!")}var full_id_parts=bbop.core.first_split(":",id);if(full_id_parts&&full_id_parts[0]&&full_id_parts[1]){var src=full_id_parts[0];var sid=full_id_parts[1];var lc_src=src.toLowerCase();var xref=global_xrefs_conf[lc_src];if(xref&&xref.image_path){retval='<img class="source" src="'+global_app_base+xref.image_path+'"/>'}}}}return retval};bbop.monarch.linker.prototype.anchor=function(args,xid,modifier){var anchor=this;var retval=null;if(args){var id=args.id;if(typeof id==="string"){retval=this.set_anchor(id,args,xid,modifier)}else{if(id instanceof Array){retval="";for(var i=0,l=id.length;i<l;i++){var anchor_tag=this.set_anchor(id[i],args,xid,modifier);if(anchor_tag){retval=retval+((retval)?", "+anchor_tag:anchor_tag)}}if(retval===""){retval=null}}}}return retval};bbop.monarch.linker.prototype.set_anchor=function(id,args,xid,modifier){var retval=null;var label=args.label;if(!label){label=id}var hilite=args.hilite;if(!hilite){hilite=label}var category=args.category;var url=this.url(id,xid,modifier,category);var img=this.img(id,xid,modifier,category);if(url){if(!retval&&img&&xid=="source-site"){retval='<a title="'+id+' (go to source page)" href="'+url+'">'+img+"</a>"}else{if(!retval&&img&&xid=="source"){retval='<a title="'+id+' (go to source page) " + href="'+url+'">'+id+"</a>"}else{if(!retval){hilite=hilite.replace(/\>/g,"&gt;");hilite=hilite.replace(/\</g,"&lt;");retval='<a title="'+id+" (go to the page for "+label+')" href="'+url+'">'+hilite+"</a>"}}}}return retval};